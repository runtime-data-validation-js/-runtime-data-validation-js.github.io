<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width">
<title>Data formats for data validation decorators, and storing data</title>



 
 
 
 













<meta name="pagename" content="Data formats for data validation decorators, and storing data">









<meta name="date" content="2022-03-08T22:20:08.792Z">

<meta name="DC.title" content="Data formats for data validation decorators, and storing data">














<!-- OpenGraph Meta Tags -->

<meta name="og:title" content="Data formats for data validation decorators, and storing data">

<meta name="og:url" content="https://example.akashacms.com/data-format.html">

































<link rel="canonical" href="https://example.akashacms.com/data-format.html">

<link rel="sitemap" type="application/xml" href="sitemap.xml" title="Sitemap">


<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="css/flatly.min.css"><link rel="stylesheet" type="text/css" href="css/style.css"><link rel="stylesheet" type="text/css" href="vendor/fontawesome-free/css/all.min.css"><link rel="stylesheet" type="text/css" href="vendor/highlight.js/styles/tomorrow-night-blue.css">

</head>
<body>
<!-- partial file-name="site-navbar.html"></partial -->
<div class="container" role="main">
<div class="row">
<div class="col-md-12">
<header class="col-md-12">
<div class="row">
<span class="col-md-12" style="text-align: center;">
<!-- <a href="/index.html"><img src="/images/project-logo.jpg" width="150px" align="left"/></a> -->
<h1 align="center">Data formats for data validation decorators, and storing data</h1>
</span>
</div>
</header>
<nav class="navbar navbar-expand-md navbar-light bg-light">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
            <a class="nav-link" href="index.html"><i class="fas fa-home"></i>Home</a>
        </li>
        <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                    Guide <span class="caret"></span></a>
            <div class="dropdown-menu">
                <a class="dropdown-item" href="getting-started.html">Getting Started</a>
                <a class="dropdown-item" href="data-format.html">Data Formats</a>
                <a class="dropdown-item" href="custom-validator.html">Custom validation</a>
                <a class="dropdown-item" href="validatation-functions.html">Validation functions</a>
            </div>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://runtime-data-validation-js.github.io/runtime-data-validation-typescript/">API</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="news/index.html">News</a>
        </li>
    </ul>
    <form class="form-inline my-2 my-lg-0" method="get" id="ddgSearch" action="https://duckduckgo.com/">
        <input type="hidden" name="sites" value="https://runtime-data-validation-js.github.io">
        <input type="hidden" name="k7" value="#ffffff">
        <input type="hidden" name="k8" value="#222222">
        <input type="hidden" name="k9" value="#00278e">
        <input type="hidden" name="kx" value="#20692b">
        <input type="hidden" name="kj" value="#fafafa">
        <input type="hidden" name="kt" value="p">
        <input type="text" name="q" placeholder="Search runtime-data-validation" aria-label="Search runtime-data-validation on DuckDuckGo">
        <button type="submit">Search</button>
    </form>
  </div>
</nav>
</div>
</div>
<div class="row">
<div class="col-md-12">
<div class="row">

<section id="breadcrumb" class="col-sm-12">
<nav aria-label="breadcrumb" id="breadcrumbTrail">
<ol class="breadcrumb">
 <li class="breadcrumb-item "> <a href="data-format.html">Data formats for data validation decorators, and storing data</a> </li>
</ol>
</nav>
</section>


<section id="category-tags" class="col-sm-12">

    Date: Tue Mar 08 2022


</section>

</div>
<div class="row">
<article class="col-sm-12">

<p>As of this writing, the validation decorators and validation functions primarily validate string data.  This is because the package is based on <code>validator.js</code> which validates <code>string</code> data items.  A few of the functions act on numbers, and in that case can take either <code>string</code> or <code>number</code> data.  Additionally, the package makes it easy to create custom validation decorators for custom data types.  Obviously there is a very long list of data types we might want to validate, so let&apos;s discuss what to do.</p>
<p>A simple example of validating <code>string</code> data is:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> {
    <span class="hljs-title class_">ValidateAccessor</span>, <span class="hljs-title class_">ValidateParams</span>,
    <span class="hljs-title class_">IsAlpha</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;runtime-data-validation&apos;</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
    #<span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;

    <span class="hljs-meta">@ValidateAccessor</span>&lt;<span class="hljs-built_in">string</span>&gt;()
    <span class="hljs-meta">@IsAlpha</span>(<span class="hljs-string">&apos;en-US&apos;</span>)
    <span class="hljs-keyword">set</span> <span class="hljs-title function_">title</span>(<span class="hljs-params">ny: <span class="hljs-built_in">string</span></span>) { <span class="hljs-variable language_">this</span>.#title = ny; }
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">title</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#title; }
}
</code></pre>
<p>The <code>IsAlpha</code> decorator ensures that the string assigned to <code>#title</code> only contains alphabetic characters.  This particular example additionally says that the text must be in the US English locale.</p>
<p>This pattern, using a private property (<code>#title</code>), ensures the only ability to modify that property is via the <code>set</code> accessor.  By attaching validation decorators to this function, we are certain that this property is protected from holding invalid data.</p>
<p>To see that in action:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> ee = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Example</span>();

ee.<span class="hljs-property">title</span> = <span class="hljs-string">&apos;AManForAllSeasons&apos;</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ee.<span class="hljs-property">title</span>);

<span class="hljs-comment">// Error: Value &apos;A Man For All Seasons&apos; is not alpha en-US</span>
ee.<span class="hljs-property">title</span> = <span class="hljs-string">&apos;A Man For All Seasons&apos;</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ee.<span class="hljs-property">title</span>);

<span class="hljs-comment">// Error: Value &apos;diplomatic&#x103;&#xEE;ntrsurpriz&#x103;&apos; is not alpha en-US</span>
ee.<span class="hljs-property">title</span> = <span class="hljs-string">&apos;diplomatic&#x103;&#xEE;ntrsurpriz&#x103;&apos;</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ee.<span class="hljs-property">title</span>);
</code></pre>
<p>The first assignment solely uses alphabetic characters, and works great.  The second has non-alphabetic characters, the spaces, and fails with the error message.  The third has some Romanian text, using characters outside of the US-ASCII character set, which also fails the validation.</p>
<p>In this case the data is assigned to the <code>set</code> function as a <code>string</code>, it arrives as a <code>string</code> to the accessor function, and is stored as a <code>string</code> in the <code>#title</code> property.</p>
<h1>Validating as a string, then converting to another type</h1>
<p>In many cases we can receive data as a <code>string</code> but want to store it as its innate data format.  For instance, a URL has a common <code>string</code> representation, but it is really a data structure.  In JavaScript that is the URL object.  Let&apos;s create a class that holds URL objects, providing a few methods to manipulate the URL.</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> {
    <span class="hljs-title class_">ValidateAccessor</span>, <span class="hljs-title class_">ValidateParams</span>,
    <span class="hljs-title class_">IsURL</span>, <span class="hljs-title class_">IsFQDN</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;runtime-data-validation&apos;</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ImgRef</span> {
    #<span class="hljs-attr">src</span>: <span class="hljs-variable constant_">URL</span>;

    <span class="hljs-meta">@ValidateAccessor</span>&lt;<span class="hljs-built_in">string</span>&gt;()
    <span class="hljs-meta">@IsURL</span>()
    <span class="hljs-keyword">set</span> <span class="hljs-title function_">src</span>(<span class="hljs-params">nurl: <span class="hljs-built_in">string</span></span>) { <span class="hljs-variable language_">this</span>.#src = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(nurl); }
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">src</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#src?.<span class="hljs-title function_">toString</span>(); }

    <span class="hljs-title function_">url</span>(<span class="hljs-params"></span>)  { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#src; }
    <span class="hljs-title function_">toString</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#src?.<span class="hljs-title function_">toString</span>(); }
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">protocol</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#src?.<span class="hljs-property">protocol</span>; }
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">pathname</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#src?.<span class="hljs-property">pathname</span>; }

    <span class="hljs-meta">@ValidateAccessor</span>&lt;<span class="hljs-built_in">string</span>&gt;()
    <span class="hljs-meta">@IsFQDN</span>()
    <span class="hljs-keyword">set</span> <span class="hljs-title function_">host</span>(<span class="hljs-params">nh: <span class="hljs-built_in">string</span></span>) { <span class="hljs-variable language_">this</span>.#src.<span class="hljs-property">host</span> = nh; }
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">host</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#src?.<span class="hljs-property">host</span>; }
}
</code></pre>
<p>The example is to store a URL for an image.  The <code>set</code> accessor receives the URL as a <code>string</code> which is validated using <code>@IsURL</code>.  But, we use <code>new URL(url)</code> to parse that to an URL object, and store it as a URL.  We can then implement other <code>get</code> accessors to retrieve fields from the URL, and a <code>toString</code> method for conversion back to string format.  There is a second <code>set</code> accessor which lets us change the <code>host</code> field of the URL.  That accessor is protected by <code>@IsFQDN</code> which ensures that the string is a fully qualified domain name.</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> ir = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImgRef</span>();

ir.<span class="hljs-property">src</span> = <span class="hljs-string">&apos;https://example.com/logo.jpg&apos;</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ir.<span class="hljs-title function_">toString</span>());
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ir.<span class="hljs-title function_">url</span>());

ir.<span class="hljs-property">host</span> = <span class="hljs-string">&apos;foo.bar&apos;</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ir.<span class="hljs-title function_">toString</span>());

<span class="hljs-comment">// https://xn--diplomatic-qgb.ro/logo.jpg</span>
ir.<span class="hljs-property">host</span> = <span class="hljs-string">&apos;diplomatic&#x103;.ro&apos;</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ir.<span class="hljs-title function_">toString</span>());

<span class="hljs-comment">// Error: Value &apos;diplomatic&#x103;&#xEE;ntrsurpriz&#x103;&apos; is not a fully qualified domain name</span>
ir.<span class="hljs-property">host</span> = <span class="hljs-string">&apos;diplomatic&#x103;&#xEE;ntrsurpriz&#x103;&apos;</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ir.<span class="hljs-title function_">toString</span>());
</code></pre>
<p>The first few lines of the test execute as expected.  Since the <code>url</code> function returns the URL object, the output in will be the object structure.  Upon assigning a value to <code>ir.host</code>, setting the <code>host</code> field of the URL, the URL changes from <code>https://example.com/logo.jpg</code> to <code>https://foo.bar/logo.jpg</code>, which is exactly what&apos;s expected.</p>
<p>Using some Romanian text along with the <code>.ro</code> top-level-domain (TLD) executes correctly, but the domain name is transliterated.</p>
<p>The last test does not use a domain name, but a simple string.  Therefore, the error shown here is thrown.</p>
<p>A similar example:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> {
    <span class="hljs-title class_">ValidateAccessor</span>, <span class="hljs-title class_">IsFloatRange</span>,
    conversions
} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;runtime-data-validation&apos;</span>;

<span class="hljs-keyword">const</span> { <span class="hljs-title class_">ToFloat</span> } = conversions;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpeedExample</span> {

    #<span class="hljs-attr">speed</span>: <span class="hljs-built_in">number</span>;

    <span class="hljs-meta">@ValidateAccessor</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>&gt;()
    <span class="hljs-meta">@IsFloatRange</span>(<span class="hljs-number">10</span>, <span class="hljs-number">70</span>)
    <span class="hljs-keyword">set</span> <span class="hljs-title function_">speed</span>(<span class="hljs-params">nc: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>) { 
        <span class="hljs-variable language_">this</span>.#speed = <span class="hljs-title class_">ToFloat</span>(nc);
    }
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">speed</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#speed; }

}
</code></pre>
<p>The <code>@IsFloatRange</code> decorator uses the <code>isFloat</code> function from <code>validator.js</code>, which only validates <code>string</code> data.  However, the implementation validates both <code>string</code> and <code>float</code>, hence the union type used here, <code>number | string</code>.  This is because <code>@IsFloatRange</code> only uses <code>isFloat</code> for string data, and if it is given a <code>number</code> it handles the validation itself.</p>
<p>Hence the <code>set</code> accessor can be given data in either format.  The <code>conversions.ToFloat</code> function takes care of converting the <code>string</code> to a <code>number</code> if needed.</p>
<p>To test it, try this:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> sp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpeedExample</span>();

sp.<span class="hljs-property">speed</span> = <span class="hljs-number">30</span>;
<span class="hljs-comment">// { speed: 30, type: &apos;number&apos; }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>({ <span class="hljs-attr">speed</span>: sp.<span class="hljs-property">speed</span>, <span class="hljs-attr">type</span>: <span class="hljs-keyword">typeof</span> sp.<span class="hljs-property">speed</span> });

sp.<span class="hljs-property">speed</span> = <span class="hljs-string">&apos;30&apos;</span>;
<span class="hljs-comment">// { speed: 30, type: &apos;number&apos; }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>({ <span class="hljs-attr">speed</span>: sp.<span class="hljs-property">speed</span>, <span class="hljs-attr">type</span>: <span class="hljs-keyword">typeof</span> sp.<span class="hljs-property">speed</span> });

<span class="hljs-comment">// Error: Value &apos;300 miles/hr&apos; not a float between 10 and 70</span>
<span class="hljs-comment">// sp.speed = 300;</span>
<span class="hljs-comment">// console.log(sp.speed);</span>

<span class="hljs-comment">// Error: Value &apos;300 miles/hr&apos; not a float between 10 and 70</span>
sp.<span class="hljs-property">speed</span> = <span class="hljs-string">&apos;300 miles/hr&apos;</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sp.<span class="hljs-property">speed</span>);
</code></pre>
<p>In the first, we assign a <code>number</code>, and in the second we assign a <code>string</code> that is numerical.  In both cases the stored value is a <code>number</code> with the correct value.</p>
<p>In the second pair we assign invalid data.  That causes an appropriate error to be thrown.</p>
<h1>Validation of non-string data</h1>
<p>The last example showed that some of the decorators handle validation of both <code>number</code> and <code>string</code> values, while most of them solely validate <code>string</code> values.</p>
<p>Generalized, the pattern is to</p>
<ul>
<li>Receive and validate data as a <code>string</code>, or in some cases as a <code>number</code></li>
<li>If appropriate, convert to another object type by parsing the string</li>
</ul>
<p>But, obviously, there are a zillion and one different data types to validate.  Sometimes we want to validate data in its native data type, rather than validating the string representation.</p>
<p>This project is welcome to receive new validator functions.</p>
<p>Additionally, it provides a function making it easy to create new validation decorators.  See: <a href="custom-validator.html" title="Developing custom data validation decorators for TypeScript">Developing custom data validation decorators for TypeScript</a></p>

</article>
<!-- <section id="right" class="col-sm-2">
<partial file-name="sidebar.html"/>
</section> -->
</div>
</div>
</div>
<footer class="row" style="text-align: center; height: 100px;">

</footer>
</div>
<script src="vendor/jquery/jquery.min.js"></script><script src="vendor/popper.js/umd/popper.min.js"></script><script src="vendor/bootstrap/js/bootstrap.min.js"></script><script src="vendor/highlight.js/lib/highlight.js"></script><script>hljs.initHighlightingOnLoad();</script>

</body>
</html>